import { useState, useCallback } from 'react';
import { Message, ChatState } from '../types';

export const useChat = (): ChatState & { sendMessage: (content: string) => Promise<void> } => {
  const [messages, setMessages] = useState<Message[]>([
    {
      id: '1',
      content: 'ä½ å¥½ï¼æˆ‘æ˜¯ **AI Feidom**ï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ã€‚\n\næˆ‘å¯ä»¥å¸®åŠ©æ‚¨å¤„ç†å„ç§é—®é¢˜ï¼ŒåŒ…æ‹¬ï¼š\n\n- ğŸ“ æ–‡æ¡£ç¼–å†™å’Œæ ¼å¼åŒ–\n- ğŸ’» ä»£ç é—®é¢˜è§£ç­”\n- ğŸ§® æ•°å­¦è®¡ç®—\n- ğŸ“Š æ•°æ®åˆ†æ\n- ğŸ¨ åˆ›æ„æ€è€ƒ\n\nè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ',
      role: 'assistant',
      timestamp: new Date()
    }
  ]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const sendMessage = useCallback(async (content: string) => {
    if (!content.trim()) return;

    const userMessage: Message = {
      id: Date.now().toString(),
      content,
      role: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    setIsLoading(true);
    setError(null);

    try {
      // æ¨¡æ‹Ÿ AI å“åº”å»¶è¿Ÿ
      await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));

      // æ™ºèƒ½ AI å“åº”ï¼ŒåŒ…å« Markdown æ ¼å¼
      const responses = [
        `## ğŸ“š å…³äºæ‚¨çš„é—®é¢˜

è¿™æ˜¯ä¸€ä¸ª**å¾ˆæœ‰è¶£**çš„é—®é¢˜ï¼è®©æˆ‘æ¥ä¸ºæ‚¨è¯¦ç»†è§£ç­”ï¼š

### ä¸»è¦è§‚ç‚¹
1. é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£é—®é¢˜çš„æœ¬è´¨
2. ç„¶ååˆ†æå¯èƒ½çš„è§£å†³æ–¹æ¡ˆ
3. æœ€åæä¾›å…·ä½“çš„å»ºè®®

> ğŸ’¡ **æç¤º**: å¦‚æœæ‚¨éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼`,

        `## ğŸ¯ æˆ‘çš„ç†è§£

æ ¹æ®æ‚¨çš„æè¿°ï¼Œæˆ‘è®¤ä¸ºæ‚¨æƒ³äº†è§£çš„æ˜¯ï¼š

\`\`\`
æ ¸å¿ƒé—®é¢˜ â†’ åˆ†ææ€è·¯ â†’ è§£å†³æ–¹æ¡ˆ
\`\`\`

### åˆ†ææ­¥éª¤
- **æ­¥éª¤1**: é—®é¢˜è¯†åˆ«
- **æ­¥éª¤2**: æ•°æ®æ”¶é›†  
- **æ­¥éª¤3**: æ–¹æ¡ˆåˆ¶å®š

æ‚¨è§‰å¾—è¿™ä¸ªåˆ†ææ€è·¯å¦‚ä½•ï¼Ÿ`,

        `## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

æˆ‘å¾ˆä¹æ„å¸®åŠ©æ‚¨è§£å†³è¿™ä¸ªé—®é¢˜ï¼

### ğŸ” é—®é¢˜åˆ†æ
è¿™ä¸ªé—®é¢˜æ¶‰åŠåˆ°å‡ ä¸ªå…³é”®ç‚¹ï¼š

1. **æŠ€æœ¯å±‚é¢**: éœ€è¦è€ƒè™‘å®ç°çš„å¯è¡Œæ€§
2. **é€»è¾‘å±‚é¢**: ç¡®ä¿æ–¹æ¡ˆçš„åˆç†æ€§
3. **å®ç”¨å±‚é¢**: ä¿è¯ç»“æœçš„æœ‰æ•ˆæ€§

### ğŸ“‹ å»ºè®®æ¸…å•
- [ ] æ˜ç¡®ç›®æ ‡å’ŒæœŸæœ›
- [ ] æ”¶é›†å¿…è¦ä¿¡æ¯
- [ ] åˆ¶å®šæ‰§è¡Œè®¡åˆ’
- [ ] ç›‘æ§æ‰§è¡Œæ•ˆæœ

**éœ€è¦æˆ‘è¯¦ç»†è¯´æ˜æŸä¸ªæ­¥éª¤å—ï¼Ÿ**`,

        `## ğŸ§  æ·±åº¦åˆ†æ

è®©æˆ‘æ¥åˆ†æä¸€ä¸‹æ‚¨çš„éœ€æ±‚ï¼š

### ğŸ“Š æ•°æ®æ¦‚è§ˆ
| æ–¹é¢ | é‡è¦æ€§ | å¤æ‚åº¦ |
|------|--------|--------|
| æŠ€æœ¯å®ç° | â­â­â­â­â­ | ğŸ”¥ğŸ”¥ğŸ”¥ |
| ç”¨æˆ·ä½“éªŒ | â­â­â­â­ | ğŸ”¥ğŸ”¥ |
| ç»´æŠ¤æˆæœ¬ | â­â­â­ | ğŸ”¥ğŸ”¥ğŸ”¥ |

### ğŸ’» ä»£ç ç¤ºä¾‹
\`\`\`javascript
function solveYourProblem(input) {
  // è¿™é‡Œæ˜¯è§£å†³æ–¹æ¡ˆçš„æ ¸å¿ƒé€»è¾‘
  const result = processInput(input);
  return optimizeResult(result);
}
\`\`\`

**è¿™æ ·çš„åˆ†æå¯¹æ‚¨æœ‰å¸®åŠ©å—ï¼Ÿ**`,

        `## ğŸ¨ åˆ›æ–°æ€è€ƒ

è¿™ç¡®å®æ˜¯ä¸€ä¸ª**å€¼å¾—æ·±å…¥è®¨è®º**çš„è¯é¢˜ï¼

### ğŸŒŸ æ ¸å¿ƒæ´å¯Ÿ
ä»å¤šä¸ªè§’åº¦æ¥çœ‹ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥è¿™æ ·ç†è§£ï¼š

#### ğŸ“ˆ è¶‹åŠ¿åˆ†æ
- **çŸ­æœŸ**: ç«‹å³å¯è¡Œçš„è§£å†³æ–¹æ¡ˆ
- **ä¸­æœŸ**: ä¼˜åŒ–å’Œæ”¹è¿›ç©ºé—´  
- **é•¿æœŸ**: å‘å±•æ½œåŠ›å’Œæ‰©å±•æ€§

#### ğŸ› ï¸ å·¥å…·æ¨è
1. **åŸºç¡€å·¥å…·**: æ»¡è¶³åŸºæœ¬éœ€æ±‚
2. **è¿›é˜¶å·¥å…·**: æå‡æ•ˆç‡
3. **ä¸“ä¸šå·¥å…·**: è§£å†³å¤æ‚é—®é¢˜

> ğŸ’­ **æ€è€ƒ**: *"æœ€å¥½çš„è§£å†³æ–¹æ¡ˆå¾€å¾€æ˜¯æœ€ç®€å•çš„æ–¹æ¡ˆ"*

æ‚¨å¸Œæœ›ä»å“ªä¸ªè§’åº¦æ·±å…¥æ¢è®¨ï¼Ÿ`,

        `## ğŸ“‹ ç»¼åˆå»ºè®®

åŸºäºæ‚¨æä¾›çš„ä¿¡æ¯ï¼Œæˆ‘çš„å»ºè®®å¦‚ä¸‹ï¼š

### ğŸ¯ æ ¸å¿ƒè¦ç‚¹
- **é‡ç‚¹å…³æ³¨**: ç¡®ä¿æ–¹æ¡ˆçš„å¯æ‰§è¡Œæ€§
- **æ³¨æ„äº‹é¡¹**: é¿å…è¿‡åº¦å¤æ‚åŒ–
- **æˆåŠŸæŒ‡æ ‡**: æ˜ç¡®è¡¡é‡æ ‡å‡†

### ğŸ“š å‚è€ƒèµ„æº
1. **å®˜æ–¹æ–‡æ¡£**: è·å–æƒå¨ä¿¡æ¯
2. **ç¤¾åŒºè®¨è®º**: äº†è§£å®è·µç»éªŒ
3. **æ¡ˆä¾‹ç ”ç©¶**: å­¦ä¹ æˆåŠŸæ¨¡å¼

### âš¡ å¿«é€Ÿå¼€å§‹
\`\`\`bash
# ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡ç¯å¢ƒ
npm install

# ç¬¬äºŒæ­¥ï¼šè¿è¡Œæµ‹è¯•
npm test

# ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½²åº”ç”¨
npm run build
\`\`\`

**è¿˜æœ‰ä»€ä¹ˆå…¶ä»–é—®é¢˜éœ€è¦æˆ‘ååŠ©è§£å†³å—ï¼Ÿ**`
      ];

      const assistantMessage: Message = {
        id: (Date.now() + 1).toString(),
        content: responses[Math.floor(Math.random() * responses.length)],
        role: 'assistant',
        timestamp: new Date()
      };

      setMessages(prev => [...prev, assistantMessage]);
    } catch (err) {
      setError('å‘é€æ¶ˆæ¯æ—¶å‡ºç°é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚');
    } finally {
      setIsLoading(false);
    }
  }, []);

  return {
    messages,
    isLoading,
    error,
    sendMessage
  };
};