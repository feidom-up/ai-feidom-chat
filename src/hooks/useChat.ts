import { useState, useCallback } from 'react';
import { Message, ChatState } from '../types';

// å®šä¹‰é—®é¢˜ç±»å‹
type QuestionType = 'code' | 'math' | 'explanation' | 'howto' | 'comparison' | 'recommendation' | 'creative' | 'general';

// AI å›ç­”ç”Ÿæˆå™¨
class AIResponseGenerator {
  // æ£€æµ‹é—®é¢˜ç±»å‹
  static detectQuestionType(input: string): QuestionType {
    const lowerInput = input.toLowerCase();
    
    if (lowerInput.includes('ä»£ç ') || lowerInput.includes('ç¼–ç¨‹') || lowerInput.includes('å‡½æ•°') || 
        lowerInput.includes('bug') || lowerInput.includes('è°ƒè¯•') || /\b(js|javascript|python|react|vue|html|css)\b/.test(lowerInput)) {
      return 'code';
    }
    
    if (lowerInput.includes('æ•°å­¦') || lowerInput.includes('è®¡ç®—') || lowerInput.includes('å…¬å¼') ||
        /\d+[+\-*/]\d+/.test(input) || lowerInput.includes('æ±‚è§£')) {
      return 'math';
    }
    
    if (lowerInput.includes('è§£é‡Š') || lowerInput.includes('æ˜¯ä»€ä¹ˆ') || lowerInput.includes('ä»€ä¹ˆæ˜¯') ||
        lowerInput.includes('å®šä¹‰') || lowerInput.includes('æ¦‚å¿µ')) {
      return 'explanation';
    }
    
    if (lowerInput.includes('æ€ä¹ˆ') || lowerInput.includes('å¦‚ä½•') || lowerInput.includes('æ–¹æ³•') ||
        lowerInput.includes('æ­¥éª¤') || lowerInput.includes('æ•™ç¨‹')) {
      return 'howto';
    }
    
    if (lowerInput.includes('æ¯”è¾ƒ') || lowerInput.includes('å¯¹æ¯”') || lowerInput.includes('åŒºåˆ«') ||
        lowerInput.includes('ä¼˜ç¼ºç‚¹') || lowerInput.includes('vs')) {
      return 'comparison';
    }
    
    if (lowerInput.includes('æ¨è') || lowerInput.includes('å»ºè®®') || lowerInput.includes('é€‰æ‹©') ||
        lowerInput.includes('å“ªä¸ªå¥½') || lowerInput.includes('æœ€ä½³')) {
      return 'recommendation';
    }
    
    if (lowerInput.includes('åˆ›æ„') || lowerInput.includes('æƒ³æ³•') || lowerInput.includes('å¤´è„‘é£æš´') ||
        lowerInput.includes('è®¾è®¡') || lowerInput.includes('æ–¹æ¡ˆ')) {
      return 'creative';
    }
    
    return 'general';
  }

  // ç”Ÿæˆä¸åŒç±»å‹çš„å›ç­”
  static generateResponse(input: string, type: QuestionType): string {
    const responses: Record<QuestionType, string[]> = {
      code: [
        `## ğŸ’» ä»£ç è§£å†³æ–¹æ¡ˆ

è®©æˆ‘æ¥å¸®æ‚¨è§£å†³è¿™ä¸ªç¼–ç¨‹é—®é¢˜ï¼

### ğŸ” é—®é¢˜åˆ†æ
åŸºäºæ‚¨çš„æè¿°ï¼Œè¿™ä¸ªé—®é¢˜æ¶‰åŠåˆ°ï¼š

\`\`\`javascript
// ç¤ºä¾‹è§£å†³æ–¹æ¡ˆ
function solveProblem(input) {
  // æ ¸å¿ƒé€»è¾‘å®ç°
  const result = processInput(input);
  
  // é”™è¯¯å¤„ç†
  if (!result) {
    throw new Error('å¤„ç†å¤±è´¥');
  }
  
  return result;
}

// ä½¿ç”¨ç¤ºä¾‹
try {
  const output = solveProblem(yourInput);
  console.log('ç»“æœ:', output);
} catch (error) {
  console.error('é”™è¯¯:', error.message);
}
\`\`\`

### ğŸ“‹ å®ç°æ­¥éª¤
1. **åˆ†æéœ€æ±‚**: æ˜ç¡®åŠŸèƒ½è¦æ±‚
2. **è®¾è®¡æ¶æ„**: è§„åˆ’ä»£ç ç»“æ„
3. **ç¼–å†™ä»£ç **: å®ç°æ ¸å¿ƒé€»è¾‘
4. **æµ‹è¯•éªŒè¯**: ç¡®ä¿åŠŸèƒ½æ­£ç¡®

### ğŸ› ï¸ æœ€ä½³å®è·µ
- âœ… ä½¿ç”¨æ¸…æ™°çš„å˜é‡å‘½å
- âœ… æ·»åŠ é€‚å½“çš„æ³¨é‡Š
- âœ… è¿›è¡Œé”™è¯¯å¤„ç†
- âœ… ç¼–å†™å•å…ƒæµ‹è¯•

éœ€è¦æˆ‘è¯¦ç»†è§£é‡ŠæŸä¸ªéƒ¨åˆ†å—ï¼Ÿ`,

        `## ğŸš€ ç¼–ç¨‹æŒ‡å¯¼

è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç¼–ç¨‹é—®é¢˜ï¼è®©æˆ‘ä¸ºæ‚¨æä¾›è¯¦ç»†çš„è§£å†³æ€è·¯ï¼š

### ğŸ¯ æ ¸å¿ƒæ€è·¯
\`\`\`
è¾“å…¥ â†’ å¤„ç† â†’ éªŒè¯ â†’ è¾“å‡º
\`\`\`

### ğŸ“Š ä»£ç æ¶æ„
\`\`\`typescript
interface Solution {
  input: any;
  process(): any;
  validate(): boolean;
  output(): any;
}

class ProblemSolver implements Solution {
  constructor(private input: any) {}
  
  process() {
    // ä¸»è¦å¤„ç†é€»è¾‘
    return this.input.map(item => this.transform(item));
  }
  
  validate() {
    // éªŒè¯ç»“æœ
    return this.input && this.input.length > 0;
  }
  
  output() {
    if (this.validate()) {
      return this.process();
    }
    throw new Error('Invalid input');
  }
}
\`\`\`

### ğŸ› å¸¸è§é™·é˜±
| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| ç©ºæŒ‡é’ˆå¼‚å¸¸ | æœªæ£€æŸ¥nullå€¼ | æ·»åŠ nullæ£€æŸ¥ |
| æ€§èƒ½é—®é¢˜ | ç®—æ³•å¤æ‚åº¦é«˜ | ä¼˜åŒ–ç®—æ³• |
| å†…å­˜æ³„æ¼ | æœªæ¸…ç†å¼•ç”¨ | åŠæ—¶é‡Šæ”¾èµ„æº |

**è¿˜éœ€è¦å…¶ä»–æŠ€æœ¯ç»†èŠ‚å—ï¼Ÿ**`
      ],

      math: [
        `## ğŸ§® æ•°å­¦è§£ç­”

è®©æˆ‘æ¥å¸®æ‚¨è§£å†³è¿™ä¸ªæ•°å­¦é—®é¢˜ï¼

### ğŸ“ é—®é¢˜åˆ†æ
æ ¹æ®æ‚¨æä¾›çš„ä¿¡æ¯ï¼Œæˆ‘éœ€è¦è¿›è¡Œä»¥ä¸‹è®¡ç®—ï¼š

### ğŸ’¡ è§£é¢˜æ€è·¯
1. **ç†è§£é¢˜æ„**: æ˜ç¡®è¦æ±‚ä»€ä¹ˆ
2. **æ‰¾å‡ºå…³é”®ä¿¡æ¯**: æå–æ•°å€¼å’Œæ¡ä»¶
3. **é€‰æ‹©æ–¹æ³•**: ç¡®å®šè§£é¢˜ç­–ç•¥
4. **è®¡ç®—è¿‡ç¨‹**: é€æ­¥æ±‚è§£

### ğŸ“ è¯¦ç»†æ­¥éª¤
\`\`\`
æ­¥éª¤1: è®¾ç½®å˜é‡å’Œå·²çŸ¥æ¡ä»¶
æ­¥éª¤2: å»ºç«‹æ•°å­¦æ¨¡å‹
æ­¥éª¤3: åº”ç”¨ç›¸å…³å…¬å¼
æ­¥éª¤4: è®¡ç®—å¹¶éªŒè¯ç»“æœ
\`\`\`

### ğŸ¯ ç­”æ¡ˆ
> **ç»“æœ**: å…·ä½“è®¡ç®—ç»“æœä¼šåœ¨è¿™é‡Œæ˜¾ç¤º

### ğŸ“š ç›¸å…³çŸ¥è¯†ç‚¹
- **å…¬å¼**: æ¶‰åŠçš„æ•°å­¦å…¬å¼
- **æ¦‚å¿µ**: ç›¸å…³æ•°å­¦æ¦‚å¿µ
- **åº”ç”¨**: å®é™…åº”ç”¨åœºæ™¯

éœ€è¦æˆ‘å±•ç¤ºå…·ä½“çš„è®¡ç®—è¿‡ç¨‹å—ï¼Ÿ`,

        `## ğŸ“Š æ•°å­¦å»ºæ¨¡

è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„æ•°å­¦é—®é¢˜ï¼è®©æˆ‘ä¸ºæ‚¨æä¾›ç³»ç»Ÿçš„åˆ†æï¼š

### ğŸ”¢ æ•°å€¼åˆ†æ
å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹æ•°æ®ï¼š

| å‚æ•° | æ•°å€¼ | å•ä½ | è¯´æ˜ |
|------|------|------|------|
| x | å˜é‡ | - | æœªçŸ¥æ•° |
| y | å‡½æ•°å€¼ | - | ç»“æœ |
| å¸¸æ•° | å›ºå®šå€¼ | - | å·²çŸ¥æ¡ä»¶ |

### ğŸ“ˆ å›¾å½¢è¡¨ç¤º
\`\`\`
y = f(x) çš„å›¾åƒç‰¹å¾:
- å®šä¹‰åŸŸ: [a, b]
- å€¼åŸŸ: [c, d]
- å•è°ƒæ€§: é€’å¢/é€’å‡
- æå€¼ç‚¹: æœ€å¤§å€¼/æœ€å°å€¼
\`\`\`

### ğŸ² æ¦‚ç‡ç»Ÿè®¡
å¦‚æœæ¶‰åŠæ¦‚ç‡é—®é¢˜ï¼š
- **æ ·æœ¬ç©ºé—´**: Î© = {æ‰€æœ‰å¯èƒ½ç»“æœ}
- **äº‹ä»¶**: A âŠ† Î©
- **æ¦‚ç‡**: P(A) = |A| / |Î©|

**éœ€è¦æˆ‘è¿›ä¸€æ­¥è®¡ç®—å…·ä½“æ•°å€¼å—ï¼Ÿ**`
      ],

      explanation: [
        `## ğŸ“š æ¦‚å¿µè§£é‡Š

å¾ˆé«˜å…´ä¸ºæ‚¨è§£é‡Šè¿™ä¸ªæ¦‚å¿µï¼

### ğŸ¯ æ ¸å¿ƒå®šä¹‰
> **ç®€å•æ¥è¯´**: ç”¨æœ€é€šä¿—çš„è¯­è¨€è§£é‡Šæ ¸å¿ƒæ¦‚å¿µ

### ğŸ§© è¯¦ç»†é˜è¿°
è¿™ä¸ªæ¦‚å¿µåŒ…å«ä»¥ä¸‹å‡ ä¸ªå…³é”®è¦ç´ ï¼š

1. **åŸºæœ¬ç‰¹å¾**: æœ€é‡è¦çš„å±æ€§å’Œç‰¹ç‚¹
2. **å·¥ä½œåŸç†**: å®ƒæ˜¯å¦‚ä½•è¿ä½œçš„
3. **åº”ç”¨åœºæ™¯**: åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šç”¨åˆ°
4. **ç›¸å…³æ¦‚å¿µ**: ä¸ä¹‹ç›¸å…³çš„å…¶ä»–æ¦‚å¿µ

### ğŸŒ° ä¸¾ä¾‹è¯´æ˜
ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œè®©æˆ‘ä»¬çœ‹å‡ ä¸ªå®é™…ä¾‹å­ï¼š

#### ä¾‹å­1: æ—¥å¸¸ç”Ÿæ´»ä¸­çš„åº”ç”¨
- **æƒ…å†µ**: å…·ä½“åœºæ™¯æè¿°
- **ä½“ç°**: æ¦‚å¿µå¦‚ä½•åœ¨å…¶ä¸­ä½“ç°
- **æ•ˆæœ**: äº§ç”Ÿçš„ç»“æœ

#### ä¾‹å­2: ä¸“ä¸šé¢†åŸŸçš„åº”ç”¨
- **èƒŒæ™¯**: ä¸“ä¸šç¯å¢ƒä»‹ç»
- **è¿ç”¨**: æ¦‚å¿µçš„å…·ä½“è¿ç”¨
- **ä»·å€¼**: å¸¦æ¥çš„ä¸“ä¸šä»·å€¼

### ğŸ’­ æ·±å…¥æ€è€ƒ
- **ä¸ºä»€ä¹ˆé‡è¦**: è¿™ä¸ªæ¦‚å¿µçš„æ„ä¹‰æ‰€åœ¨
- **å†å²å‘å±•**: æ¦‚å¿µçš„æ¼”è¿›è¿‡ç¨‹
- **æœªæ¥è¶‹åŠ¿**: å¯èƒ½çš„å‘å±•æ–¹å‘

è¿˜æœ‰ä»€ä¹ˆç»†èŠ‚éœ€è¦æˆ‘è¿›ä¸€æ­¥è§£é‡Šçš„å—ï¼Ÿ`,

        `## ğŸ” æ·±åº¦è§£æ

è®©æˆ‘ä¸ºæ‚¨æä¾›è¿™ä¸ªä¸»é¢˜çš„å…¨é¢è§£æï¼š

### ğŸ“– åŸºç¡€çŸ¥è¯†
é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š

\`\`\`
æ ¸å¿ƒæ¦‚å¿µ = åŸºç¡€è¦ç´  + ç»„åˆè§„å¾‹ + åº”ç”¨æ–¹æ³•
\`\`\`

### ğŸ—ï¸ ç»“æ„åˆ†æ
| å±‚çº§ | å†…å®¹ | é‡è¦æ€§ |
|------|------|--------|
| è¡¨å±‚ | ç›´è§‚ç°è±¡ | â­â­â­ |
| ä¸­å±‚ | è¿è¡Œæœºåˆ¶ | â­â­â­â­ |
| æ·±å±‚ | æœ¬è´¨è§„å¾‹ | â­â­â­â­â­ |

### ğŸ­ å¤šè§’åº¦è§†è§’
- **ç†è®ºè§’åº¦**: å­¦æœ¯å’Œç§‘å­¦çš„è§‚ç‚¹
- **å®è·µè§’åº¦**: åº”ç”¨å’Œæ“ä½œçš„å±‚é¢
- **å†å²è§’åº¦**: å‘å±•å’Œæ¼”å˜çš„è¿‡ç¨‹
- **æœªæ¥è§’åº¦**: è¶‹åŠ¿å’Œå¯èƒ½çš„å˜åŒ–

### ğŸ§  è®°å¿†æŠ€å·§
ä¸ºäº†å¸®åŠ©æ‚¨æ›´å¥½åœ°è®°ä½å’Œç†è§£ï¼š
1. **å…³é”®è¯è”æƒ³**: æ‰¾å‡ºæ ¸å¿ƒå…³é”®è¯
2. **å›¾åƒåŒ–è®°å¿†**: å°†æŠ½è±¡æ¦‚å¿µå…·è±¡åŒ–
3. **ç±»æ¯”å­¦ä¹ **: ä¸ç†Ÿæ‚‰çš„äº‹ç‰©å¯¹æ¯”

**æ‚¨å¸Œæœ›æˆ‘é‡ç‚¹è®²è§£å“ªä¸ªæ–¹é¢ï¼Ÿ**`
      ],

      howto: [
        `## ğŸ“‹ æ“ä½œæŒ‡å—

æˆ‘æ¥ä¸ºæ‚¨æä¾›è¯¦ç»†çš„æ“ä½œæ­¥éª¤ï¼

### ğŸ¯ å‡†å¤‡å·¥ä½œ
åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²ç»å‡†å¤‡å¥½ï¼š
- âœ… å¿…è¦çš„å·¥å…·å’Œææ–™
- âœ… åŸºç¡€çŸ¥è¯†å’ŒæŠ€èƒ½
- âœ… å……è¶³çš„æ—¶é—´å’Œç²¾åŠ›

### ğŸ“ è¯¦ç»†æ­¥éª¤

#### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å‡†å¤‡
1. **ç¯å¢ƒé…ç½®**
   - è®¾ç½®å·¥ä½œç¯å¢ƒ
   - æ£€æŸ¥å¿…è¦æ¡ä»¶
   - å‡†å¤‡æ‰€éœ€èµ„æº

2. **åˆå§‹åŒ–è®¾ç½®**
   \`\`\`bash
   # ç¤ºä¾‹å‘½ä»¤
   mkdir project
   cd project
   npm init -y
   \`\`\`

#### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒå®æ–½
3. **ä¸»è¦æ“ä½œ**
   - æŒ‰ç…§æ ‡å‡†æµç¨‹æ‰§è¡Œ
   - æ³¨æ„å…³é”®èŠ‚ç‚¹æ§åˆ¶
   - åŠæ—¶è®°å½•è¿›å±•

4. **è´¨é‡æ§åˆ¶**
   - å®šæœŸæ£€æŸ¥ç»“æœ
   - å¯¹æ¯”é¢„æœŸç›®æ ‡
   - å¿…è¦æ—¶è¿›è¡Œè°ƒæ•´

#### ç¬¬ä¸‰é˜¶æ®µï¼šå®Œå–„ä¼˜åŒ–
5. **æµ‹è¯•éªŒè¯**
   - åŠŸèƒ½æ€§æµ‹è¯•
   - æ€§èƒ½æµ‹è¯•
   - ç”¨æˆ·ä½“éªŒæµ‹è¯•

6. **æœ€ç»ˆä¼˜åŒ–**
   - æ ¹æ®æµ‹è¯•ç»“æœè°ƒæ•´
   - å®Œå–„ç»†èŠ‚å¤„ç†
   - å½¢æˆæœ€ç»ˆæ–¹æ¡ˆ

### âš ï¸ æ³¨æ„äº‹é¡¹
- **å¸¸è§é”™è¯¯**: é¿å…è¿™äº›å…¸å‹é—®é¢˜
- **å…³é”®è¦ç‚¹**: ä¸èƒ½å¿½è§†çš„é‡è¦ç¯èŠ‚
- **å¤‡é€‰æ–¹æ¡ˆ**: é‡åˆ°é—®é¢˜æ—¶çš„æ›¿ä»£é€‰æ‹©

### ğŸ† æˆåŠŸæ ‡å‡†
- [ ] è¾¾åˆ°é¢„æœŸåŠŸèƒ½
- [ ] æ€§èƒ½æŒ‡æ ‡åˆæ ¼
- [ ] ç”¨æˆ·æ»¡æ„åº¦é«˜

éœ€è¦æˆ‘è¯¦ç»†è§£é‡ŠæŸä¸ªå…·ä½“æ­¥éª¤å—ï¼Ÿ`
      ],

      comparison: [
        `## âš–ï¸ å¯¹æ¯”åˆ†æ

æˆ‘æ¥ä¸ºæ‚¨æä¾›å…¨é¢çš„å¯¹æ¯”åˆ†æï¼

### ğŸ“Š æ ¸å¿ƒå¯¹æ¯”

| ç»´åº¦ | æ–¹æ¡ˆA | æ–¹æ¡ˆB | èƒœå‡ºæ–¹ |
|------|-------|-------|--------|
| **æ€§èƒ½** | ğŸŸ¢ ä¼˜ç§€ | ğŸŸ¡ è‰¯å¥½ | A |
| **æˆæœ¬** | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¢ è¾ƒä½ | B |
| **æ˜“ç”¨æ€§** | ğŸŸ¢ ç®€å• | ğŸ”´ å¤æ‚ | A |
| **æ‰©å±•æ€§** | ğŸŸ¡ æœ‰é™ | ğŸŸ¢ å¼ºå¤§ | B |
| **ç¨³å®šæ€§** | ğŸŸ¢ å¾ˆç¨³å®š | ğŸŸ¢ å¾ˆç¨³å®š | å¹³å±€ |

### ğŸ¯ è¯¦ç»†åˆ†æ

#### ä¼˜åŠ¿å¯¹æ¯”
**æ–¹æ¡ˆAçš„ä¼˜åŠ¿ï¼š**
- âœ… æ€§èƒ½è¡¨ç°å‡ºè‰²
- âœ… å­¦ä¹ æˆæœ¬ä½
- âœ… ç¤¾åŒºæ”¯æŒå¥½
- âœ… æ–‡æ¡£å®Œå–„

**æ–¹æ¡ˆBçš„ä¼˜åŠ¿ï¼š**
- âœ… æˆæœ¬æ›´ç»æµ
- âœ… åŠŸèƒ½æ›´ä¸°å¯Œ
- âœ… å®šåˆ¶æ€§å¼º
- âœ… æœªæ¥æ½œåŠ›å¤§

### ğŸª ä½¿ç”¨åœºæ™¯
- **é€‰æ‹©A**: å¦‚æœæ‚¨é‡è§†ç®€å•å¿«é€Ÿã€é¢„ç®—å……è¶³
- **é€‰æ‹©B**: å¦‚æœæ‚¨éœ€è¦æ·±åº¦å®šåˆ¶ã€é•¿æœŸå‘å±•

### ğŸ† æ¨èå»ºè®®
åŸºäºæ‚¨çš„å…·ä½“éœ€æ±‚ï¼Œæˆ‘çš„å»ºè®®æ˜¯ï¼š
> **ç»“è®º**: æ ¹æ®å…·ä½“æƒ…å†µç»™å‡ºæ¨è

éœ€è¦æˆ‘é’ˆå¯¹æ‚¨çš„å…·ä½“æƒ…å†µåšæ›´è¯¦ç»†çš„åˆ†æå—ï¼Ÿ`
      ],

      recommendation: [
        `## ğŸ¯ ä¸“ä¸šæ¨è

åŸºäºæ‚¨çš„éœ€æ±‚ï¼Œæˆ‘æ¥ä¸ºæ‚¨æä¾›ä¸“ä¸šçš„æ¨èå»ºè®®ï¼

### ğŸ† æœ€ä½³é€‰æ‹©
ç»è¿‡ç»¼åˆåˆ†æï¼Œæˆ‘çš„**é¦–è¦æ¨è**æ˜¯ï¼š

> **æ¨èæ–¹æ¡ˆ**: å…·ä½“æ¨èçš„é€‰é¡¹
> 
> **æ¨èç†ç”±**: è¿™ä¸ªé€‰æ‹©åœ¨æ‚¨çš„ä½¿ç”¨åœºæ™¯ä¸‹å…·æœ‰æœ€ä½³çš„æ€§ä»·æ¯”å’Œå®ç”¨æ€§

### ğŸ“Š æ¨èä¾æ®

#### ğŸª åŒ¹é…åº¦åˆ†æ
- **éœ€æ±‚åŒ¹é…**: â­â­â­â­â­ (å®Œç¾ç¬¦åˆ)
- **é¢„ç®—é€‚é…**: â­â­â­â­ (æ€§ä»·æ¯”é«˜)
- **æŠ€èƒ½è¦æ±‚**: â­â­â­ (å®¹æ˜“æŒæ¡)
- **æœªæ¥æ‰©å±•**: â­â­â­â­ (å‘å±•ç©ºé—´å¤§)

### ğŸ“‹ å®æ–½å»ºè®®

#### ğŸš€ å¿«é€Ÿå¼€å§‹
1. **ç¬¬ä¸€æ­¥**: ä»æœ€åŸºç¡€çš„åŠŸèƒ½å¼€å§‹
2. **ç¬¬äºŒæ­¥**: é€æ­¥æ·»åŠ é«˜çº§ç‰¹æ€§
3. **ç¬¬ä¸‰æ­¥**: æ ¹æ®ä½¿ç”¨æƒ…å†µä¼˜åŒ–è°ƒæ•´

### ğŸ’¡ ä¸“å®¶æç¤º
- **å…³é”®æˆåŠŸå› ç´ **: æœ€é‡è¦çš„å‡ ä¸ªè¦ç‚¹
- **å¸¸è§é™·é˜±**: éœ€è¦é¿å…çš„é—®é¢˜
- **ä¼˜åŒ–å»ºè®®**: æå‡æ•ˆæœçš„æ–¹æ³•

æœ‰ä»€ä¹ˆå…·ä½“é—®é¢˜éœ€è¦æˆ‘è¿›ä¸€æ­¥è§£ç­”å—ï¼Ÿ`
      ],

      creative: [
        `## ğŸ¨ åˆ›æ„æ€è€ƒ

è®©æˆ‘ä»¬ä¸€èµ·å‘æŒ¥åˆ›æ„ï¼Œæ¢ç´¢è¿™ä¸ªè¯é¢˜çš„æ— é™å¯èƒ½ï¼

### ğŸ’¡ å¤´è„‘é£æš´
é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»ä¸åŒè§’åº¦æ€è€ƒï¼š

#### ğŸŒˆ åˆ›æ„ç»´åº¦
- **ä¼ ç»Ÿè§†è§’**: å¸¸è§„çš„ç†è§£å’Œæ–¹æ³•
- **é€†å‘æ€ç»´**: åå…¶é“è€Œè¡Œä¹‹çš„å¯èƒ½
- **è·¨ç•Œèåˆ**: ç»“åˆå…¶ä»–é¢†åŸŸçš„å…ƒç´ 
- **æœªæ¥æƒ³è±¡**: å‰ç»æ€§çš„åˆ›æ–°æ€è·¯

### ğŸª åˆ›æ„æ–¹æ¡ˆ

#### æ–¹æ¡ˆ1: "çªç ´è¾¹ç•Œ"
\`\`\`
æ ¸å¿ƒç†å¿µ: æ‰“ç ´å¸¸è§„é™åˆ¶
å®ç°æ–¹å¼: 
  - é‡æ–°å®šä¹‰é—®é¢˜æœ¬è´¨
  - å¼•å…¥å…¨æ–°æŠ€æœ¯å…ƒç´ 
  - åˆ›é€ ç‹¬ç‰¹ç”¨æˆ·ä½“éªŒ
é¢„æœŸæ•ˆæœ: é¢ è¦†æ€§åˆ›æ–°
\`\`\`

### ğŸš€ åˆ›æ–°è¦ç´ 
| è¦ç´  | ä¼ ç»Ÿåšæ³• | åˆ›æ–°æ€è·¯ | çªç ´ç‚¹ |
|------|----------|----------|--------|
| äº¤äº’æ–¹å¼ | ç‚¹å‡»æ“ä½œ | æ‰‹åŠ¿/è¯­éŸ³/AI | è‡ªç„¶äº¤äº’ |
| è§†è§‰è®¾è®¡ | å¹³é¢å¸ƒå±€ | 3D/AR/åŠ¨æ•ˆ | æ²‰æµ¸ä½“éªŒ |
| æ•°æ®å¤„ç† | é™æ€åˆ†æ | å®æ—¶æ™ºèƒ½ | é¢„æµ‹èƒ½åŠ› |

### ğŸ­ æƒ…æ„Ÿè¿æ¥
åˆ›æ„ä¸ä»…ä»…æ˜¯åŠŸèƒ½ï¼Œæ›´è¦åˆ›é€ æƒ…æ„Ÿå…±é¸£ï¼š
- **æƒŠå–œæ„Ÿ**: è¶…å‡ºé¢„æœŸçš„ä½“éªŒ
- **æˆå°±æ„Ÿ**: è®©ç”¨æˆ·æ„Ÿåˆ°è‡ªè±ª
- **å½’å±æ„Ÿ**: åˆ›é€ ç¤¾åŒºå’Œæ–‡åŒ–

æƒ³è¦æ·±å…¥æ¢è®¨å“ªä¸ªåˆ›æ„æ–¹å‘ï¼Ÿ`
      ],

      general: [
        `## ğŸ’¬ ç»¼åˆè§£ç­”

æ„Ÿè°¢æ‚¨çš„æé—®ï¼è®©æˆ‘ä¸ºæ‚¨æä¾›å…¨é¢çš„å›ç­”ï¼š

### ğŸ¯ é—®é¢˜ç†è§£
æ ¹æ®æ‚¨çš„æè¿°ï¼Œæˆ‘ç†è§£æ‚¨æƒ³äº†è§£çš„æ˜¯å…³äºï¼š

- **æ ¸å¿ƒè¦ç‚¹**: é—®é¢˜çš„æœ¬è´¨å’Œå…³é”®
- **ç›¸å…³ä¿¡æ¯**: ä¸æ­¤ç›¸å…³çš„èƒŒæ™¯çŸ¥è¯†
- **å®é™…åº”ç”¨**: åœ¨ç°å®ä¸­çš„è¿ç”¨æƒ…å†µ

### ğŸ“š è¯¦ç»†åˆ†æ

#### ğŸ” å¤šç»´åº¦è§£è¯»
è®©æˆ‘ä»¬ä»å‡ ä¸ªä¸åŒè§’åº¦æ¥åˆ†æè¿™ä¸ªé—®é¢˜ï¼š

1. **ç†è®ºå±‚é¢**: åŸºç¡€æ¦‚å¿µå’ŒåŸç†
2. **å®è·µå±‚é¢**: å…·ä½“æ“ä½œå’Œåº”ç”¨
3. **å‘å±•å±‚é¢**: è¶‹åŠ¿å’Œæœªæ¥å¯èƒ½

#### ğŸ“Š å…³é”®ä¿¡æ¯
| æ–¹é¢ | æè¿° | é‡è¦æ€§ |
|------|------|--------|
| åŸºç¡€æ¦‚å¿µ | æ ¸å¿ƒå®šä¹‰å’Œç‰¹å¾ | â­â­â­â­â­ |
| åº”ç”¨åœºæ™¯ | å®é™…ä½¿ç”¨æƒ…å†µ | â­â­â­â­ |
| å‘å±•è¶‹åŠ¿ | æœªæ¥å˜åŒ–æ–¹å‘ | â­â­â­ |

### ğŸŒŸ æ ¸å¿ƒè§‚ç‚¹
> **é‡è¦æç¤º**: è¿™ä¸ªé—®é¢˜æ¶‰åŠå¤šä¸ªå±‚é¢ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘å„ç§å› ç´ 

### ğŸ’¡ å®ç”¨å»ºè®®
åŸºäºåˆ†æï¼Œæˆ‘çš„å»ºè®®æ˜¯ï¼š

1. **çŸ­æœŸè¡ŒåŠ¨**: ç«‹å³å¯ä»¥é‡‡å–çš„æªæ–½
2. **ä¸­æœŸè§„åˆ’**: é˜¶æ®µæ€§çš„å‘å±•è®¡åˆ’  
3. **é•¿æœŸå±•æœ›**: æœªæ¥çš„å‘å±•æ–¹å‘

**æ‚¨å¸Œæœ›æˆ‘è¯¦ç»†å±•å¼€è®¨è®ºå“ªä¸ªå…·ä½“æ–¹é¢ï¼Ÿ**`
      ]
    };

    const typeResponses = responses[type];
    return typeResponses[Math.floor(Math.random() * typeResponses.length)];
  }

  // æ ¹æ®è¾“å…¥ç”Ÿæˆä¸ªæ€§åŒ–å›ç­”
  static generatePersonalizedResponse(input: string): string {
    const questionType = this.detectQuestionType(input);
    const baseResponse = this.generateResponse(input, questionType);
    
    // æ·»åŠ ä¸ªæ€§åŒ–å…ƒç´ ï¼Œæ¯”å¦‚å¼•ç”¨ç”¨æˆ·çš„å…·ä½“é—®é¢˜
    const personalizedIntro = this.getPersonalizedIntro(input, questionType);
    
    return personalizedIntro + '\n\n' + baseResponse;
  }

  // ç”Ÿæˆä¸ªæ€§åŒ–å¼€å¤´
  static getPersonalizedIntro(input: string, type: QuestionType): string {
    const inputPreview = input.length > 30 ? input.slice(0, 30) + "..." : input;
    
    const intros: Record<QuestionType, string[]> = {
      code: [
        `å…³äºæ‚¨æåˆ°çš„"${inputPreview}"è¿™ä¸ªç¼–ç¨‹é—®é¢˜ï¼Œ`,
        `çœ‹åˆ°æ‚¨åœ¨å¤„ç†"${inputPreview}"ç›¸å…³çš„ä»£ç é—®é¢˜ï¼Œ`,
        `é’ˆå¯¹æ‚¨æè¿°çš„"${inputPreview}"è¿™ä¸ªæŠ€æœ¯æŒ‘æˆ˜ï¼Œ`
      ],
      math: [
        `å…³äºæ‚¨çš„æ•°å­¦é—®é¢˜"${inputPreview}"ï¼Œ`,
        `çœ‹åˆ°æ‚¨éœ€è¦è®¡ç®—"${inputPreview}"ï¼Œ`,
        `é’ˆå¯¹æ‚¨æå‡ºçš„"${inputPreview}"è¿™ä¸ªæ•°å­¦é—®é¢˜ï¼Œ`
      ],
      explanation: [
        `æ‚¨æƒ³äº†è§£"${inputPreview}"çš„ç›¸å…³æ¦‚å¿µï¼Œ`,
        `å…³äº"${inputPreview}"è¿™ä¸ªè¯é¢˜ï¼Œ`,
        `é’ˆå¯¹æ‚¨è¯¢é—®çš„"${inputPreview}"ï¼Œ`
      ],
      howto: [
        `å…³äºæ‚¨æƒ³çŸ¥é“å¦‚ä½•"${inputPreview}"ï¼Œ`,
        `çœ‹åˆ°æ‚¨éœ€è¦äº†è§£"${inputPreview}"çš„æ“ä½œæ–¹æ³•ï¼Œ`,
        `é’ˆå¯¹æ‚¨è¯¢é—®çš„"${inputPreview}"æ­¥éª¤ï¼Œ`
      ],
      comparison: [
        `å…³äºæ‚¨æåˆ°çš„"${inputPreview}"å¯¹æ¯”é—®é¢˜ï¼Œ`,
        `çœ‹åˆ°æ‚¨éœ€è¦æ¯”è¾ƒ"${inputPreview}"ï¼Œ`,
        `é’ˆå¯¹æ‚¨è¯¢é—®çš„"${inputPreview}"åˆ†æï¼Œ`
      ],
      recommendation: [
        `å…³äºæ‚¨å¯»æ±‚"${inputPreview}"çš„å»ºè®®ï¼Œ`,
        `çœ‹åˆ°æ‚¨éœ€è¦"${inputPreview}"æ–¹é¢çš„æ¨èï¼Œ`,
        `é’ˆå¯¹æ‚¨è¯¢é—®çš„"${inputPreview}"é€‰æ‹©ï¼Œ`
      ],
      creative: [
        `å…³äºæ‚¨çš„åˆ›æ„æƒ³æ³•"${inputPreview}"ï¼Œ`,
        `çœ‹åˆ°æ‚¨åœ¨æ€è€ƒ"${inputPreview}"çš„åˆ›æ–°æ–¹æ¡ˆï¼Œ`,
        `é’ˆå¯¹æ‚¨æå‡ºçš„"${inputPreview}"è®¾è®¡æ€è·¯ï¼Œ`
      ],
      general: [
        `å…³äºæ‚¨æåˆ°çš„"${inputPreview}"ï¼Œ`,
        `çœ‹åˆ°æ‚¨çš„é—®é¢˜"${inputPreview}"ï¼Œ`,
        `é’ˆå¯¹æ‚¨å…³å¿ƒçš„"${inputPreview}"è¿™ä¸ªè¯é¢˜ï¼Œ`
      ]
    };

    const typeIntros = intros[type];
    return typeIntros[Math.floor(Math.random() * typeIntros.length)];
  }
}

export const useChat = (): ChatState & { sendMessage: (content: string) => Promise<void> } => {
  const [messages, setMessages] = useState<Message[]>([
    {
      id: '1',
      content: `# ğŸ¤– æ¬¢è¿ä½¿ç”¨ AI Feidom Chatï¼

æˆ‘æ˜¯æ‚¨çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œèƒ½å¤Ÿå¸®åŠ©æ‚¨è§£å†³å„ç§ç±»å‹çš„é—®é¢˜ï¼š

## ğŸ¯ æˆ‘èƒ½å¸®æ‚¨åšä»€ä¹ˆï¼Ÿ

### ğŸ’» æŠ€æœ¯å¼€å‘
- **ç¼–ç¨‹é—®é¢˜**: ä»£ç è°ƒè¯•ã€ç®—æ³•è®¾è®¡ã€æœ€ä½³å®è·µ
- **æŠ€æœ¯é€‰å‹**: æ¡†æ¶å¯¹æ¯”ã€å·¥å…·æ¨èã€æ¶æ„è®¾è®¡
- **é—®é¢˜æ’æŸ¥**: Bugåˆ†æã€æ€§èƒ½ä¼˜åŒ–ã€è§£å†³æ–¹æ¡ˆ

### ğŸ“š å­¦ä¹ æ•™è‚²  
- **æ¦‚å¿µè§£é‡Š**: æ·±å…¥æµ…å‡ºåœ°è§£é‡Šå¤æ‚æ¦‚å¿µ
- **çŸ¥è¯†æ¢³ç†**: ç³»ç»ŸåŒ–æ•´ç†ç›¸å…³çŸ¥è¯†ç‚¹
- **å­¦ä¹ æŒ‡å¯¼**: æä¾›å­¦ä¹ è·¯å¾„å’Œæ–¹æ³•å»ºè®®

### ğŸ§® æ•°æ®åˆ†æ
- **æ•°å­¦è®¡ç®—**: å¤æ‚è¿ç®—ã€å…¬å¼æ¨å¯¼ã€ç»Ÿè®¡åˆ†æ
- **æ•°æ®è§£è¯»**: å›¾è¡¨åˆ†æã€è¶‹åŠ¿é¢„æµ‹ã€æ´å¯Ÿå‘ç°
- **å»ºæ¨¡æ€è·¯**: æ•°å­¦å»ºæ¨¡ã€ç®—æ³•è®¾è®¡ã€ä¼˜åŒ–æ–¹æ¡ˆ

### ğŸ¨ åˆ›æ„æ€è€ƒ
- **å¤´è„‘é£æš´**: åˆ›æ–°æƒ³æ³•ã€è§£å†³æ–¹æ¡ˆã€è®¾è®¡æ€è·¯
- **æ–¹æ¡ˆè®¾è®¡**: é¡¹ç›®è§„åˆ’ã€æµç¨‹ä¼˜åŒ–ã€ç­–ç•¥åˆ¶å®š
- **è·¨ç•Œæ€ç»´**: å¤šè§’åº¦åˆ†æã€åˆ›æ–°ç»„åˆã€çµæ„Ÿæ¿€å‘

### ğŸ’¡ å†³ç­–æ”¯æŒ
- **å¯¹æ¯”åˆ†æ**: å¤šæ–¹æ¡ˆæ¯”è¾ƒã€ä¼˜åŠ£è¯„ä¼°ã€é€‰æ‹©å»ºè®®
- **é£é™©è¯„ä¼°**: æ½œåœ¨é—®é¢˜è¯†åˆ«ã€åº”å¯¹ç­–ç•¥ã€é¢„é˜²æªæ–½
- **å®æ–½æŒ‡å¯¼**: å…·ä½“æ­¥éª¤ã€æ³¨æ„äº‹é¡¹ã€æˆåŠŸè¦ç´ 

---

ğŸŒŸ **ç‰¹è‰²åŠŸèƒ½**ï¼šæ‰€æœ‰å›ç­”éƒ½é‡‡ç”¨ç»“æ„åŒ–çš„ Markdown æ ¼å¼ï¼ŒåŒ…å«ä¸°å¯Œçš„è¡¨æ ¼ã€ä»£ç å—ã€åˆ—è¡¨ç­‰ï¼Œè®©ä¿¡æ¯æ›´æ¸…æ™°æ˜“è¯»ï¼

è¯·å‘Šè¯‰æˆ‘æ‚¨é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä¼šä¸ºæ‚¨æä¾›è¯¦ç»†çš„è§£ç­”å’Œå»ºè®®ï¼`,
      role: 'assistant',
      timestamp: new Date()
    }
  ]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const sendMessage = useCallback(async (content: string) => {
    if (!content.trim()) return;

    const userMessage: Message = {
      id: Date.now().toString(),
      content,
      role: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    setIsLoading(true);
    setError(null);

    try {
      // æ¨¡æ‹Ÿ AI å“åº”å»¶è¿Ÿï¼ˆæ ¹æ®é—®é¢˜å¤æ‚åº¦è°ƒæ•´ï¼‰
      const complexity = AIResponseGenerator.detectQuestionType(content);
      const baseDelay = complexity === 'code' || complexity === 'math' ? 2000 : 1500;
      const randomDelay = Math.random() * 1000;
      
      await new Promise(resolve => setTimeout(resolve, baseDelay + randomDelay));

      // ç”Ÿæˆæ™ºèƒ½ AI å“åº”
      const aiResponse = AIResponseGenerator.generatePersonalizedResponse(content);

      const assistantMessage: Message = {
        id: (Date.now() + 1).toString(),
        content: aiResponse,
        role: 'assistant',
        timestamp: new Date()
      };

      setMessages(prev => [...prev, assistantMessage]);
    } catch (err) {
      setError('å‘é€æ¶ˆæ¯æ—¶å‡ºç°é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚');
    } finally {
      setIsLoading(false);
    }
  }, []);

  return {
    messages,
    isLoading,
    error,
    sendMessage
  };
};