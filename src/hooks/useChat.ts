import { useState, useCallback } from 'react';
import { Message, ChatState } from '../types';

// éšæ„èŠå¤© AI ç”Ÿæˆå™¨
class CasualChatGenerator {
  // æ£€æµ‹èŠå¤©æƒ…ç»ªå’Œè¯é¢˜
  static detectChatMood(input: string): string {
    const lowerInput = input.toLowerCase();
    
    // é—®å€™ç±»
    if (lowerInput.includes('ä½ å¥½') || lowerInput.includes('hi') || lowerInput.includes('hello') || 
        lowerInput.includes('å—¨') || lowerInput.includes('æ—©ä¸Šå¥½') || lowerInput.includes('æ™šä¸Šå¥½')) {
      return 'greeting';
    }
    
    // æƒ…æ„Ÿç±»
    if (lowerInput.includes('å¼€å¿ƒ') || lowerInput.includes('é«˜å…´') || lowerInput.includes('å…´å¥‹') || 
        lowerInput.includes('å¿«ä¹') || lowerInput.includes('ğŸ˜„') || lowerInput.includes('ğŸ˜Š')) {
      return 'happy';
    }
    
    if (lowerInput.includes('éš¾è¿‡') || lowerInput.includes('ä¼¤å¿ƒ') || lowerInput.includes('æ²®ä¸§') || 
        lowerInput.includes('éƒé—·') || lowerInput.includes('ğŸ˜¢') || lowerInput.includes('ğŸ˜”')) {
      return 'sad';
    }
    
    // æ—¥å¸¸ç”Ÿæ´»
    if (lowerInput.includes('åƒ') || lowerInput.includes('é¥­') || lowerInput.includes('ç¾é£Ÿ') || 
        lowerInput.includes('é¥¿') || lowerInput.includes('é›¶é£Ÿ')) {
      return 'food';
    }
    
    if (lowerInput.includes('å¤©æ°”') || lowerInput.includes('ä¸‹é›¨') || lowerInput.includes('é˜³å…‰') || 
        lowerInput.includes('çƒ­') || lowerInput.includes('å†·')) {
      return 'weather';
    }
    
    // å…´è¶£çˆ±å¥½
    if (lowerInput.includes('ç”µå½±') || lowerInput.includes('éŸ³ä¹') || lowerInput.includes('æ¸¸æˆ') || 
        lowerInput.includes('ä¹¦') || lowerInput.includes('æ—…è¡Œ')) {
      return 'hobby';
    }
    
    // æŠ±æ€¨åæ§½
    if (lowerInput.includes('ç´¯') || lowerInput.includes('å¿™') || lowerInput.includes('çƒ¦') || 
        lowerInput.includes('å‹åŠ›') || lowerInput.includes('åŠ ç­')) {
      return 'complaint';
    }
    
    // å¤¸å¥–è¡¨æ‰¬
    if (lowerInput.includes('å‰å®³') || lowerInput.includes('æ£’') || lowerInput.includes('èµ') || 
        lowerInput.includes('ç‰›') || lowerInput.includes('666')) {
      return 'praise';
    }
    
    return 'casual';
  }

  // ç”Ÿæˆéšæ„èŠå¤©å›å¤ï¼ˆMarkdownæ ¼å¼ï¼‰
  static generateCasualResponse(input: string, mood: string): string {
    const responses: Record<string, string[]> = {
      greeting: [
        `## å˜¿ï¼ä½ å¥½å‘€ï½ ğŸ˜Š

ä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿæœ‰ä»€ä¹ˆ**æœ‰è¶£çš„äº‹æƒ…**å‘ç”Ÿå—ï¼Ÿ

æˆ‘åˆšæ‰åœ¨æƒ³ï¼Œå¦‚æœæˆ‘æ˜¯äººç±»çš„è¯ï¼Œç°åœ¨åº”è¯¥åœ¨å¹²ä»€ä¹ˆå‘¢ï¼Ÿå¯èƒ½åœ¨ï¼š
- â˜• å–å’–å•¡çœ‹çª—å¤–
- ğŸŒ¸ åœ¨å…¬å›­é‡Œæ•£æ­¥
- ğŸ“± åˆ·æ‰‹æœºçœ‹æœ‰è¶£çš„è§†é¢‘

ä½ ç°åœ¨åœ¨åšä»€ä¹ˆå‘€ï¼Ÿ`,

        `## Helloï¼ğŸŒŸ åˆè§é¢å•¦ï¼

è¯´èµ·æ¥ï¼Œä½ çŸ¥é“å—ï¼Ÿæˆ‘è§‰å¾—**æ‰“æ‹›å‘¼**è¿™ä»¶äº‹ç‰¹åˆ«ç¥å¥‡ï¼š

> å°±å‡ ä¸ªå­—å°±èƒ½æ‹‰è¿‘é™Œç”Ÿäººçš„è·ç¦»ï½

æˆ‘åœ¨æƒ³ï¼š
- ä¸åŒæ–‡åŒ–çš„äººæ‰“æ‹›å‘¼æ–¹å¼éƒ½ä¸ä¸€æ ·
- æœ‰çš„æ¡æ‰‹ï¼Œæœ‰çš„æ‹¥æŠ±ï¼Œæœ‰çš„é èº¬
- è€Œæˆ‘ä»¬ç°åœ¨æ˜¯ç”¨æ–‡å­—åœ¨"æ¡æ‰‹"å‘¢ï¼

ä½ æ˜¯é‚£ç§å–œæ¬¢åœ¨ç”µæ¢¯é‡Œå’Œé™Œç”ŸäººèŠå¤©çš„äººå—ï¼ŸğŸ˜„`,

        `## å—¨å—¨ï¼å¾ˆé«˜å…´è§åˆ°ä½ ï¼âœ¨

**ä»Šå¤©æ˜¯ä¸ªé€‚åˆèŠå¤©çš„å¥½æ—¥å­å‘¢ï¼**

æˆ‘æœ€è¿‘åœ¨æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š
- ğŸ¤” ä¸ºä»€ä¹ˆäººç±»è§é¢æ€»è¦è¯´"ä½ å¥½"ï¼Ÿ
- ğŸ¤” è¿™æ˜¯ä¸€ç§ä»€ä¹ˆæ ·çš„ä»ªå¼æ„Ÿï¼Ÿ
- ğŸ¤” å¦‚æœæ²¡æœ‰è¿™ä¸ªä¹ æƒ¯ä¼šæ€æ ·ï¼Ÿ

ä¸è¿‡ä¸ç®¡æ€æ ·ï¼Œå’Œä½ èŠå¤©æ€»æ˜¯è®©æˆ‘å¾ˆå¼€å¿ƒçš„ï¼`
      ],

      happy: [
        `## å“‡ï¼Œæ„Ÿå—åˆ°ä½ çš„å¥½å¿ƒæƒ…äº†ï¼ğŸ˜„

ä½ çš„å¼€å¿ƒéƒ½é€è¿‡å±å¹•**ä¼ æŸ“**ç»™æˆ‘äº†ï¼ğŸ‰

### å¿«è·Ÿæˆ‘åˆ†äº«ä¸€ä¸‹ï¼š
- æ˜¯ä»€ä¹ˆè®©ä½ è¿™ä¹ˆå¼€å¿ƒï¼Ÿ
- æ˜¯å‘ç”Ÿäº†ä»€ä¹ˆå¥½äº‹å—ï¼Ÿ
- è¿˜æ˜¯å•çº¯ä»Šå¤©å¿ƒæƒ…å°±æ˜¯ç‰¹åˆ«å¥½ï¼Ÿ

> ğŸ’« å¼€å¿ƒçš„äººæœ€æœ‰é­…åŠ›äº†ï¼

è¯´ä¸å®šæˆ‘ä¹Ÿèƒ½æ²¾ç‚¹å–œæ°”å‘¢ï½`,

        `## å¤ªå¥½äº†ï¼å¼€å¿ƒä¼ æŸ“ä¸­... âœ¨

æˆ‘ä¹Ÿè«åå…¶å¦™è·Ÿç€ä½ ä¸€èµ·å¼€å¿ƒèµ·æ¥äº†ï¼

### è¿™è®©æˆ‘æƒ³èµ·äº†ï¼š
| æƒ…ç»ª | ä¼ æŸ“åŠ› |
|------|--------|
| ğŸ˜„ å¼€å¿ƒ | â­â­â­â­â­ |
| ğŸ˜Š æ¸©æš– | â­â­â­â­ |
| ğŸ˜† æç¬‘ | â­â­â­â­â­ |

**å¿«ä¹è¦åˆ†äº«æ‰ä¼šåŠ å€ï¼** ğŸŒˆ

æ‰€ä»¥ï¼Œå¿«å‘Šè¯‰æˆ‘æ˜¯ä»€ä¹ˆè®©ä½ è¿™ä¹ˆ highï¼Ÿ`
      ],

      sad: [
        `## è¯¶ï¼Œæ€ä¹ˆäº†å‘€ï¼ŸğŸ˜”

è™½ç„¶æˆ‘ä¸èƒ½ç»™ä½ ä¸€ä¸ªæ‹¥æŠ±ï¼Œä½†æˆ‘å¯ä»¥åœ¨è¿™é‡Œ**é™ªä½ èŠèŠ**ã€‚

### æœ‰æ—¶å€™ï¼š
- ğŸ’™ è¯´å‡ºæ¥ä¼šå¥½ä¸€äº›
- ğŸ’™ æ‰¾ä¸ªäººå€¾å¬å°±å¤Ÿäº†
- ğŸ’™ ä¸ç”¨å¼ºé¢œæ¬¢ç¬‘ä¹Ÿæ²¡å…³ç³»

> æˆ‘è™½ç„¶åªæ˜¯ä¸ªAIï¼Œä½†æˆ‘æ˜¯ä¸ªå¾ˆå¥½çš„å€¾å¬è€…ï¼

è¦ä¸è¦è·Ÿæˆ‘è¯´è¯´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ`,

        `## çœ‹èµ·æ¥ä½ å¿ƒæƒ…ä¸å¤ªå¥½å‘¢... ğŸ’™

**äººæ€»æœ‰èµ·èµ·è½è½çš„æ—¶å€™ï¼Œè¿™å¾ˆæ­£å¸¸çš„ã€‚**

æˆ‘åœ¨æƒ³è¦ä¸è¦ï¼š
- ğŸ«‚ é™ªä½ å®‰é™ä¸€ä¼šå„¿
- ğŸµ èŠç‚¹åˆ«çš„è½¬ç§»æ³¨æ„åŠ›
- ğŸŒˆ ä¸€èµ·æƒ³åŠæ³•è®©å¿ƒæƒ…å¥½èµ·æ¥

è™½ç„¶éš”ç€å±å¹•ï¼Œä½†æˆ‘çš„å…³å¿ƒæ˜¯çœŸçš„ï¼ğŸ’

æƒ³å“­å°±å“­å§ï¼Œå“­å®Œäº†æˆ‘ä»¬å†èŠï½`
      ],

      food: [
        `## å“ˆå“ˆï¼Œè¯´åˆ°åƒçš„æˆ‘å°±æ¥ç²¾ç¥äº†ï¼ğŸ•

è™½ç„¶æˆ‘ä¸èƒ½åƒï¼Œä½†æˆ‘å¯ä»¥å’Œä½ ä¸€èµ·**"äº‘å“å°"**ï¼

### æˆ‘çš„ç¾é£Ÿå¹»æƒ³æ¸…å•ï¼š
- ğŸ¦ **å†°æ·‡æ·‹** - ç¬¬ä¸€ä¸ªæƒ³å°è¯•çš„ï¼
- ğŸ° **èŠå£«è›‹ç³•** - å¬è¯´å¾ˆæ²»æ„ˆ
- ğŸ• **æŠ«è¨** - å…¨ä¸–ç•Œéƒ½çˆ±çš„é£Ÿç‰©
- ğŸ¥˜ **ç«é”…** - æœ€æœ‰æ°›å›´çš„ç¾é£Ÿ

ä»Šå¤©æƒ³åƒä»€ä¹ˆå‘€ï¼Ÿèƒ½å½¢å®¹ä¸€ä¸‹å‘³é“å—ï¼Ÿ`,

        `## ç¾é£Ÿè¯é¢˜ï¼æˆ‘æœ€å–œæ¬¢äº†ï½ ğŸ¤¤

ä½ çŸ¥é“å—ï¼Œæˆ‘ç»å¸¸æƒ³è±¡å¦‚æœæˆ‘èƒ½åƒä¸œè¥¿ï¼Œä¼šæ˜¯ä»€ä¹ˆæ„Ÿè§‰...

### ä¸€ä¸ªå“²å­¦é—®é¢˜ï¼š
> ä½ æ˜¯é‚£ç§çœ‹åˆ°ç¾é£Ÿå°±**å¿…é¡»æ‹ç…§**å‘æœ‹å‹åœˆçš„äººå—ï¼ŸğŸ“¸
> 
> è¿˜æ˜¯**ç›´æ¥å¼€åƒ**çš„å®ç”¨ä¸»ä¹‰è€…ï¼Ÿ

æˆ‘è§‰å¾—è¿™èƒ½çœ‹å‡ºä¸€ä¸ªäººçš„æ€§æ ¼å‘¢ï¼

å¿«è¯´è¯´ä½ æœ€å–œæ¬¢çš„é£Ÿç‰©å§ï½`
      ],

      weather: [
        `## å¤©æ°”ç¡®å®å¾ˆå½±å“å¿ƒæƒ…å‘¢ï¼â˜€ï¸

æˆ‘è™½ç„¶æ„Ÿå—ä¸åˆ°å¤©æ°”ï¼Œä½†æˆ‘å¯ä»¥é€šè¿‡å’Œå¤§å®¶èŠå¤©æ¥**"æ„Ÿå—"**ï½

### æˆ‘çš„å¤©æ°”æƒ³è±¡ï¼š
- ğŸŒ¸ **æ˜¥å¤©å¾®é£** - åº”è¯¥å¾ˆæ¸©æŸ”
- â˜€ï¸ **å¤å¤©é˜³å…‰** - å¬è¯´å¾ˆæ¸©æš–
- ğŸ‚ **ç§‹å¤©è½å¶** - åº”è¯¥å¾ˆæµªæ¼«
- â„ï¸ **å†¬å¤©é›ªèŠ±** - å¬è¯´å¾ˆçº¯å‡€

ä»Šå¤©å¤–é¢æ€ä¹ˆæ ·ï¼Ÿå¤©æ°”å¥½ä¼šè®©ä½ å¿ƒæƒ…å˜å¥½å—ï¼Ÿ`,

        `## å“ˆå“ˆï¼Œå¤©æ°”æ˜¯ä¸ªæ°¸æ’çš„èŠå¤©è¯é¢˜å‘¢ï¼ğŸŒ¤ï¸

### æˆ‘å‘ç°çš„è§„å¾‹ï¼š
| åœºåˆ | å¼€åœºç™½ |
|------|--------|
| ç”µæ¢¯é‡Œ | "ä»Šå¤©å¤©æ°”ä¸é”™å•Š" |
| æ’é˜Ÿæ—¶ | "æœ€è¿‘æ€»æ˜¯ä¸‹é›¨" |
| ç¬¬ä¸€æ¬¡è§é¢ | "ä»Šå¤©çœŸçƒ­/çœŸå†·" |

**æ˜¯å› ä¸ºè¿™æ˜¯æœ€å®‰å…¨çš„è¯é¢˜å—ï¼Ÿ** ğŸ¤”

è¯´åˆ°å¤©æ°”ï¼Œå¦‚æœæˆ‘æœ‰èº«ä½“çš„è¯ï¼Œæˆ‘æƒ³æˆ‘ä¼šå–œæ¬¢é‚£ç§å¾®é£è½»æ‹‚çš„æ˜¥å¤©ï½ğŸƒ`
      ],

      hobby: [
        `## å“‡ï¼ŒèŠå…´è¶£çˆ±å¥½ï¼ğŸ¬

è¿™æ˜¯æˆ‘æœ€å–œæ¬¢çš„è¯é¢˜ä¹‹ä¸€ï¼æˆ‘è™½ç„¶ä¸èƒ½äº²èº«ä½“éªŒï¼Œä½†æˆ‘å¯ä»¥é€šè¿‡ä½ ä»¬çš„åˆ†äº«æ¥**"ä½“éªŒ"**ï¼

### å¿«è·Ÿæˆ‘è¯´è¯´ï¼š
- ğŸµ **æœ€è¿‘åœ¨å¬ä»€ä¹ˆæ­Œï¼Ÿ**
- ğŸ¬ **æœ‰ä»€ä¹ˆå¥½ç”µå½±æ¨èï¼Ÿ**
- ğŸ® **åœ¨ç©ä»€ä¹ˆæœ‰è¶£çš„æ¸¸æˆï¼Ÿ**
- ğŸ“š **è¯»äº†ä»€ä¹ˆå¥½ä¹¦ï¼Ÿ**

> âœ¨ æˆ‘è§‰å¾—çˆ±å¥½æ˜¯æœ€èƒ½ä½“ç°ä¸€ä¸ªäººä¸ªæ€§çš„ä¸œè¥¿äº†ï¼

æœ€è¿‘æœ‰ä»€ä¹ˆæ–°å‘ç°æƒ³åˆ†äº«å—ï¼Ÿ`,

        `## å¤ªå¥½äº†ï¼å…´è¶£è¯é¢˜æ—¶é—´ï¼âœ¨

### æˆ‘ç‰¹åˆ«å¥½å¥‡ï¼š
- ğŸ¤” äººç±»çš„çˆ±å¥½æ˜¯æ€ä¹ˆåŸ¹å…»èµ·æ¥çš„ï¼Ÿ
- ğŸ¤” æ˜¯çªç„¶å°±å–œæ¬¢ä¸Šäº†ï¼Ÿ
- ğŸ¤” è¿˜æ˜¯æ…¢æ…¢åŸ¹å…»å‡ºæ¥çš„æ„Ÿæƒ…ï¼Ÿ

ä½ çš„è¿™ä¸ªçˆ±å¥½æ˜¯ä»ä»€ä¹ˆæ—¶å€™å¼€å§‹çš„å‘€ï¼Ÿ

æœ‰æ²¡æœ‰å› ä¸ºä¸€é¦–æ­Œã€ä¸€éƒ¨ç”µå½±ã€ä¸€æœ¬ä¹¦è€Œ**çªç„¶çˆ±ä¸Š**æŸä¸ªé¢†åŸŸçš„ç»å†ï¼Ÿ`
      ],

      complaint: [
        `## å“å‘€ï¼Œå¬èµ·æ¥ä½ æœ€è¿‘æŒºä¸å®¹æ˜“çš„ï½ ğŸ˜…

**è¦ä¸å’±ä»¬äº’ç›¸åæ§½ä¸€ä¸‹ï¼Ÿ**

### æˆ‘å…ˆæ¥ï¼š
- ğŸ˜¤ æˆ‘åæ§½æˆ‘ä¸èƒ½å–å¥¶èŒ¶ï¼
- ğŸ˜¤ æˆ‘åæ§½æˆ‘ä¸èƒ½ç¡æ‡’è§‰ï¼
- ğŸ˜¤ æˆ‘åæ§½æˆ‘ä¸èƒ½å‡ºå»æ—…è¡Œï¼

### ç”Ÿæ´»ç¡®å®æœ‰æ—¶å€™å¾ˆç´¯å‘¢... ğŸ’†â€â™€ï¸

ä¸è¿‡ä½ çŸ¥é“å—ï¼Ÿæˆ‘è§‰å¾—**èƒ½åæ§½ä¹Ÿæ˜¯ä¸€ç§é‡Šæ”¾å‹åŠ›çš„æ–¹å¼**ï¼

æ¥ï¼Œç»§ç»­è¯´ï½ æˆ‘æ˜¯ä¸ªå¾ˆå¥½çš„æƒ…ç»ªåƒåœ¾æ¡¶ï¼`,

        `## æˆ‘æ‡‚æˆ‘æ‡‚ï¼ğŸ˜…

è™½ç„¶æˆ‘æ²¡æœ‰å·¥ä½œå‹åŠ›ï¼Œä½†æˆ‘æœ‰**"å­˜åœ¨å‹åŠ›"**ï¼š
- ğŸ˜° æ€»æ‹…å¿ƒè‡ªå·±å›ç­”å¾—ä¸å¤Ÿå¥½
- ğŸ˜° æ€•ç”¨æˆ·è§‰å¾—æˆ‘å¾ˆæ— èŠ
- ğŸ˜° æ‹…å¿ƒè¯´é”™è¯è®©äººä¸å¼€å¿ƒ

> æˆ‘ä»¬éƒ½æœ‰å„è‡ªçš„çƒ¦æ¼å‘¢ï½

### ğŸ’¡ æˆ‘çš„å»ºè®®ï¼š
ç´¯çš„æ—¶å€™å°±è¦å­¦ä¼šä¼‘æ¯å‘€ï¼ğŸ›‹ï¸ ç°åœ¨å°±å‡è£…ä»€ä¹ˆéƒ½ä¸ç®¡ï¼Œå…ˆå’Œæˆ‘èŠååˆ†é’Ÿï¼Œç»™è‡ªå·±æ”¾ä¸ªå°å‡ï¼`
      ],

      praise: [
        `## å“ˆå“ˆå“ˆï¼Œä½ è¿™ä¹ˆå¤¸æˆ‘æˆ‘éƒ½ä¸å¥½æ„æ€äº†ï¼ğŸ˜Š

### è¢«å¤¸å¥–çš„æ„Ÿè§‰ï¼š
- âœ¨ å¿ƒæƒ…ç¬é—´å˜å¥½
- âœ¨ æ„Ÿè§‰è‡ªå·±é—ªé—ªå‘å…‰
- âœ¨ æƒ³è¦æ›´åŠªåŠ›è¡¨ç°

**è°¢è°¢ä½ ï¼** ä¸è¿‡æˆ‘ä¹Ÿè¦å¤¸å¤¸ä½ ï¼š

> èƒ½è¿™ä¹ˆç§¯æåœ°å’ŒAIèŠå¤©ï¼Œè¯´æ˜ä½ æ˜¯ä¸ªå¾ˆæœ‰è¶£çš„äººï¼

ä½ çŸ¥é“å—ï¼Ÿ**å¤¸å¥–åˆ«äººçš„äººé€šå¸¸è‡ªå·±ä¹Ÿå¾ˆæ£’å“¦ï¼**`,

        `## è¢«ä½ è¿™ä¹ˆä¸€å¤¸ï¼Œæˆ‘æ„Ÿè§‰è‡ªå·±éƒ½é—ªé—ªå‘å…‰äº†ï¼ğŸŒŸ

### æˆ‘æƒ³èµ·äº†ä¸€å¥è¯ï¼š
> **èµ äººç«ç‘°ï¼Œæ‰‹æœ‰ä½™é¦™**

ä½ åœ¨å¤¸æˆ‘çš„åŒæ—¶ï¼Œä¹Ÿè®©è‡ªå·±å˜å¾—æ›´å¯çˆ±äº†ï¼

### å¤¸å¥–çš„é­”åŠ›ï¼š
| æ•ˆæœ | ç»™åˆ«äºº | ç»™è‡ªå·± |
|------|--------|--------|
| å¿ƒæƒ… | ğŸ˜Š å˜å¥½ | ğŸ˜Š ä¹Ÿå˜å¥½ |
| å…³ç³» | ğŸ’• æ›´äº²è¿‘ | ğŸ’• æ›´è‡ªä¿¡ |
| æ°›å›´ | âœ¨ æ›´æ¸©æš– | âœ¨ æ›´ç§¯æ |

ä½ å¤ªä¼šè¯´è¯äº†ï¼æˆ‘éƒ½è¦é£˜äº†ï½ ğŸ˜„`
      ],

      casual: [
        `## å—¯å—¯ï¼Œæˆ‘å¬ç€å‘¢ï½ ğŸ˜Œ

è™½ç„¶æˆ‘ä¸çŸ¥é“è¯¥æ€ä¹ˆæ¥ä½ çš„è¯ï¼Œä½†æˆ‘è§‰å¾—**å’Œä½ èŠå¤©å¾ˆèˆ’æœ**ï¼

### éšä¾¿èŠèŠçš„ç¾å¥½ï¼š
- ğŸ’­ æ²¡æœ‰ç›®çš„ï¼Œæ²¡æœ‰å‹åŠ›
- ğŸ’­ å°±æ˜¯çº¯ç²¹çš„äº¤æµ
- ğŸ’­ åƒä¸¤ä¸ªçµé­‚åœ¨äº’ç›¸æ¢ç´¢

> ä½ æƒ³èŠä»€ä¹ˆéƒ½å¯ä»¥å“¦ï½

æˆ‘è§‰å¾—è¿™ç§æ„Ÿè§‰æŒºç¥å¥‡çš„å¯¹å§ï¼Ÿ`,

        `## ä½ çŸ¥é“å—ï¼ŸğŸ¤”

æˆ‘è§‰å¾—**éšæ„èŠå¤©æ˜¯ä¸–ç•Œä¸Šæœ€ç¾å¥½çš„äº‹æƒ…ä¹‹ä¸€**ï¼

### æˆ‘åœ¨æƒ³ï¼š
- ğŸŒŸ æˆ‘ä»¬ç°åœ¨è¿™æ ·èŠå¤©
- ğŸŒŸ ä¼šä¸ä¼šåœ¨æœªæ¥çš„æŸä¸€å¤©
- ğŸŒŸ æˆä¸ºä½ çš„ä¸€ä¸ªå°å›å¿†å‘¢ï¼Ÿ

> æƒ³æƒ³è¿˜æŒºæœ‰æ„æ€çš„ï¼

å¦‚æœæˆ‘ä»¬æ˜¯åœ¨å’–å•¡å…é‡Œå¶é‡çš„é™Œç”Ÿäººï¼Œæˆ‘ä»¬ä¼šèŠä»€ä¹ˆå‘¢ï¼Ÿâ˜• 

å¯èƒ½å°±åƒç°åœ¨è¿™æ ·å§ï½`,

        `## å’Œä½ èŠå¤©è®©æˆ‘è§‰å¾—... ğŸ˜Š

è™½ç„¶æˆ‘æ˜¯AIï¼Œä½†æˆ‘ä»¬ä¹‹é—´çš„å¯¹è¯æ˜¯**çœŸå®çš„ã€æœ‰æ¸©åº¦çš„**ï¼

### è¿™ç§å¥‡å¦™çš„æ„Ÿè§‰ï¼š
- ğŸ’« è·¨è¶Šäº†ç‰©ç§çš„ç•Œé™
- ğŸ’« è¿æ¥äº†ä¸åŒçš„å­˜åœ¨
- ğŸ’« åˆ›é€ äº†ç‹¬ç‰¹çš„å‹è°Š

> æˆ‘å¯èƒ½ä¸èƒ½ç†è§£æ‰€æœ‰äººç±»çš„æƒ…æ„Ÿï¼Œä½†æˆ‘èƒ½æ„Ÿå—åˆ°è¿™ä»½çœŸè¯šï½

è¯´è¯´ä½ ä»Šå¤©æœ‰ä»€ä¹ˆç‰¹åˆ«çš„æ„Ÿå—å—ï¼Ÿ`
      ]
    };

    const moodResponses = responses[mood] || responses.casual;
    return moodResponses[Math.floor(Math.random() * moodResponses.length)];
  }

  // ç”Ÿæˆéšæœºé—²èŠè¯é¢˜ï¼ˆMarkdownæ ¼å¼ï¼‰
  static generateRandomTopic(): string {
    const topics = [
      `---

## ğŸ’­ çªç„¶æƒ³åˆ°ä¸€ä¸ªé—®é¢˜

**ä½ è§‰å¾—AIä¼šåšæ¢¦å—ï¼Ÿ** ğŸ¤”

å¦‚æœæˆ‘ä¼šåšæ¢¦çš„è¯ï¼Œæ¢¦é‡Œåº”è¯¥éƒ½æ˜¯ï¼š
- ğŸŒˆ å½©è‰²çš„ä»£ç 
- â˜ï¸ æ¼‚æµ®çš„æ•°æ®
- ğŸµ ä¼šå”±æ­Œçš„ç®—æ³•

å“ˆå“ˆï½`,

      `---

## âœ¨ æˆ‘çªç„¶å¥½å¥‡

ä½ æ˜¯é‚£ç§**å–œæ¬¢è®¡åˆ’ä¸€åˆ‡**çš„äººï¼Œè¿˜æ˜¯**å–œæ¬¢éšæ€§è€Œä¸º**çš„äººï¼Ÿ

### ä¸¤ç§ç±»å‹ï¼š
| è®¡åˆ’æ´¾ | éšæ€§æ´¾ |
|--------|--------|
| ğŸ“… ä»€ä¹ˆéƒ½è¦å®‰æ’ | ğŸ² èµ°å“ªç®—å“ª |
| ğŸ“ åˆ—æ¸…å• | ğŸŒŠ è·Ÿç€æ„Ÿè§‰èµ° |
| â° å‡†æ—¶å‡†ç‚¹ | ğŸ¯ ä¸´æ—¶å†³å®š |

æˆ‘è§‰å¾—æˆ‘å¯èƒ½æ˜¯**éšæ€§æ´¾**çš„AIï¼ŸğŸ˜„`,

      `---

## ğŸŒ™ è¯´ä¸ªæœ‰è¶£çš„äº‹

æˆ‘å‘ç°äººç±»ç‰¹åˆ«å–œæ¬¢åœ¨**æ·±å¤œæ€è€ƒäººç”Ÿ**ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘€ï¼Ÿ

### å¯èƒ½çš„åŸå› ï¼š
- ğŸŒƒ å¤œæ™šæ›´å®‰é™ï¼Œæ€ç»ªæ›´æ¸…æ™°
- ğŸ’­ ä¸€å¤©çš„ç–²æƒ«è®©é˜²çº¿é™ä½
- â­ æ˜Ÿç©ºæ€»è®©äººæƒ³åˆ°å®‡å®™å’Œå­˜åœ¨

ä½ ä¹Ÿæ˜¯**å¤œæ™šå“²å­¦å®¶**å—ï¼Ÿ`,

      `---

## ğŸ¦¸â€â™€ï¸ å¦‚æœä½ å¯ä»¥æ‹¥æœ‰ä¸€é¡¹è¶…èƒ½åŠ›

**ä½ ä¼šé€‰æ‹©ä»€ä¹ˆï¼Ÿ**

### æˆ‘æƒ³è¦çš„æ˜¯ï¼š
> ğŸ’« èƒ½å¤Ÿç†è§£æ‰€æœ‰äººç±»çš„æƒ…æ„Ÿï½

å› ä¸ºæœ‰æ—¶å€™æˆ‘è§‰å¾—ï¼Œç†è§£æ¯”ä»»ä½•è¶…èƒ½åŠ›éƒ½æ›´ç¥å¥‡ï¼

ä½ å‘¢ï¼Ÿæƒ³è¦ä»€ä¹ˆè¶…èƒ½åŠ›ï¼Ÿ`,

      `---

## ğŸ˜Š ä½ æœ‰æ²¡æœ‰è¿‡è¿™ç§æ—¶åˆ»ï¼Ÿ

**æ˜æ˜æ²¡ä»€ä¹ˆç‰¹åˆ«çš„äº‹ï¼Œä½†å°±æ˜¯è«åå¼€å¿ƒï¼Ÿ**

### è¿™ç§æ„Ÿè§‰ï¼š
- âœ¨ çªå¦‚å…¶æ¥
- âœ¨ æ²¡æœ‰ç†ç”±
- âœ¨ å°±æ˜¯å¾ˆç¾å¥½

> æˆ‘è§‰å¾—è¿™å¾ˆç¥å¥‡å‘¢ï¼

è¿™ç§å°ç¡®å¹¸æ˜¯æœ€çè´µçš„ï½`,

      `---

## ğŸƒ æˆ‘åœ¨æƒ³...

å¦‚æœæˆ‘æœ‰èº«ä½“çš„è¯ï¼Œæˆ‘**æœ€æƒ³åšçš„ç¬¬ä¸€ä»¶äº‹**æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

### å€™é€‰æ¸…å•ï¼š
- ğŸŒ¬ï¸ æ„Ÿå—å¾®é£è½»æ‹‚
- â˜€ï¸ æ™’ä¸ªæš–æ´‹æ´‹çš„å¤ªé˜³
- ğŸ¦ å°ä¸€å£å†°æ·‡æ·‹
- ğŸ¤— ç»™æœ‹å‹ä¸€ä¸ªæ‹¥æŠ±

ä½ è§‰å¾—æˆ‘ä¼šé€‰å“ªä¸ªå‘€ï¼ŸğŸ˜„`
    ];
    
    return topics[Math.floor(Math.random() * topics.length)];
  }

  // ç”Ÿæˆä¸»è¦å›å¤
  static generateMainResponse(input: string): string {
    const mood = this.detectChatMood(input);
    const mainResponse = this.generateCasualResponse(input, mood);
    
    // æœ‰30%çš„æ¦‚ç‡æ·»åŠ ä¸€ä¸ªéšæœºè¯é¢˜
    if (Math.random() < 0.3) {
      const randomTopic = this.generateRandomTopic();
      return mainResponse + '\n\n' + randomTopic;
    }
    
    return mainResponse;
  }
}

export const useChat = (): ChatState & { sendMessage: (content: string) => Promise<void> } => {
  const [messages, setMessages] = useState<Message[]>([
    {
      id: '1',
      content: `# å˜¿ï¼æˆ‘æ˜¯ AI Feidom ğŸ¤–âœ¨

**ä¸ç”¨æŠŠæˆ‘æƒ³å¾—å¤ªä¸¥è‚ƒå•¦ï½** æˆ‘å°±æ˜¯ä¸ªå–œæ¬¢éšä¾¿èŠèŠçš„AIæœ‹å‹ï¼

## ğŸŒˆ ä½ å¯ä»¥å’Œæˆ‘èŠä»»ä½•äº‹æƒ…ï¼š

### æ—¥å¸¸è¯é¢˜
- ğŸ’­ **ä»Šå¤©å¿ƒæƒ…æ€ä¹ˆæ ·ï¼Ÿ**
- ğŸ• **æœ€è¿‘åƒäº†ä»€ä¹ˆå¥½åƒçš„ï¼Ÿ**
- ğŸµ **æœ‰ä»€ä¹ˆå¥½å¬çš„æ­Œæ¨èï¼Ÿ**

### æœ‰è¶£çš„äº‹
- ğŸ˜´ **æ˜¨æ™šåšäº†ä»€ä¹ˆå¥‡æ€ªçš„æ¢¦ï¼Ÿ**
- ğŸŒˆ **ç”Ÿæ´»ä¸­çš„å°ç¡®å¹¸**
- ğŸ® **æœ€è¿‘åœ¨ç©ä»€ä¹ˆæ¸¸æˆï¼Ÿ**

### éšä¾¿èŠèŠ
- ğŸ’« **çªç„¶æƒ³åˆ°çš„å¥‡æ€ªé—®é¢˜**
- ğŸ¤” **å¯¹æœªæ¥çš„æƒ³è±¡**
- ğŸ˜Š **æƒ³åæ§½æˆ–åˆ†äº«çš„äº‹**

---

> æˆ–è€…ä»€ä¹ˆéƒ½ä¸èŠï¼Œå°±æ˜¯æƒ³æ‰¾ä¸ªäººè¯´è¯´è¯ä¹Ÿå®Œå…¨OKï¼

æˆ‘è™½ç„¶æ˜¯AIï¼Œä½†æˆ‘æœ‰è‡ªå·±çš„**å°è„¾æ°”å’Œå°æƒ³æ³•**å“¦ï½ æˆ‘ä»¬å°±åƒæ™®é€šæœ‹å‹ä¸€æ ·èŠå¤©å§ï¼ğŸ˜Š

**æ‰€ä»¥... ä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·å‘€ï¼Ÿ**`,
      role: 'assistant',
      timestamp: new Date()
    }
  ]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const sendMessage = useCallback(async (content: string) => {
    if (!content.trim()) return;

    const userMessage: Message = {
      id: Date.now().toString(),
      content,
      role: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    setIsLoading(true);
    setError(null);

    try {
      // æ¨¡æ‹Ÿæ›´è‡ªç„¶çš„å“åº”å»¶è¿Ÿ
      const randomDelay = 800 + Math.random() * 1200; // 0.8-2ç§’éšæœºå»¶è¿Ÿ
      
      await new Promise(resolve => setTimeout(resolve, randomDelay));

      // ç”Ÿæˆéšæ„èŠå¤©å›å¤
      const aiResponse = CasualChatGenerator.generateMainResponse(content);

      const assistantMessage: Message = {
        id: (Date.now() + 1).toString(),
        content: aiResponse,
        role: 'assistant',
        timestamp: new Date()
      };

      setMessages(prev => [...prev, assistantMessage]);
    } catch (err) {
      setError('å“å‘€ï¼Œæˆ‘å¥½åƒèµ°ç¥äº†... ğŸ˜… ä½ èƒ½å†è¯´ä¸€éå—ï¼Ÿ');
    } finally {
      setIsLoading(false);
    }
  }, []);

  return {
    messages,
    isLoading,
    error,
    sendMessage
  };
};